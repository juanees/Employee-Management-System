generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model Employee {
  id             String          @id @default(uuid())
  dni            String          @unique
  firstName      String
  lastName       String
  email          String          @unique
  taxStatus      String          @default("unknown")
  status         String          @default("active")
  roles          String          @default("[]")
  hiredAt        DateTime        @default(now())
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  vehicles       Vehicle[]
  travel         TravelRequest[]
  ledJobs        Job[]           @relation("JobLeader")
  jobAssignments JobAssignment[]
}

model Vehicle {
  id                  String   @id @default(uuid())
  plateNumber         String   @unique
  model               String
  year                Int
  insuranceExpiresOn  DateTime
  vtvExpiresOn        DateTime
  status              String   @default("available")
  assignedEmployeeId  String?
  assignedEmployee    Employee? @relation(fields: [assignedEmployeeId], references: [id])
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt
  travelRequests      TravelRequest[]
}

model TravelRequest {
  id               String   @id @default(uuid())
  employeeId       String
  vehicleId        String?
  origin           String
  destination      String
  startDate        DateTime
  endDate          DateTime
  purpose          String
  status           String   @default("pending_approval")
  approverComments String?
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  employee         Employee @relation(fields: [employeeId], references: [id])
  vehicle          Vehicle? @relation(fields: [vehicleId], references: [id])
}

model Role {
  id          String   @id @default(uuid())
  name        String   @unique
  description String?
  permissions String   @default("[]")
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model JobTemplate {
  id            String   @id @default(uuid())
  title         String
  description   String?
  defaultRoles  String   @default("[]")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  jobs          Job[]
}

model Job {
  id          String          @id @default(uuid())
  title       String
  description String?
  leaderId    String
  templateId  String?
  leader      Employee        @relation("JobLeader", fields: [leaderId], references: [id])
  template    JobTemplate?    @relation(fields: [templateId], references: [id])
  assignments JobAssignment[]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
}

model JobAssignment {
  id          String   @id @default(uuid())
  jobId       String
  employeeId  String
  role        String   @default("member")
  job         Job      @relation(fields: [jobId], references: [id])
  employee    Employee @relation(fields: [employeeId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([jobId, employeeId])
}
